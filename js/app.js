"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var SEMVER_REGEX=function SEMVER_REGEX(){return/\bv?(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)(?:-[\da-z-]+(?:\.[\da-z-]+)*)?(?:\+[\da-z-]+(?:\.[\da-z-]+)*)?\b/gi};var DATE_REGEX=function DATE_REGEX(){return/(\d{4})-(\d{2})-(\d{2})/gi};var GITHUB_BOOK_SVG='<svg class="octicon octicon-repo" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"></path></svg>';var $ERROR_PARSING_MESSAGE='\n    <div class="error-parsing-message">We could not process correctly the CHANGELOG file.<br/>\n    We <span style="color: #e34c26;">❤</span> CHANGELOG files that respect <a href="https://keepachangelog.com" target="_blank">https://keepachangelog.com</a> convention.</div>\n';var ERROR_FETCH_MESSAGE="Could not fetch the CHANGELOG file.";var NOTIFIER_DELAY=5e3;var headingsWithSemVer=[];var REPOSITORIES=[];var ORDERED_REPOSITORIES=[];var choicesItems=[];var choiceSelectReference=void 0;var timelineReference=void 0;var selectedRepository=void 0;var $repositoryDropdown=void 0;var $visualization=void 0;var $visualizationData=void 0;var $githubLink=void 0;var uniqueArray=function uniqueArray(a){return[].concat(_toConsumableArray(new Set(a.map(function(o){return JSON.stringify(o)})))).map(function(s){return JSON.parse(s)})};document.addEventListener("DOMContentLoaded",function(){start()});if("serviceWorker"in navigator){}var start=function start(){$repositoryDropdown=document.getElementById("repository-dropdown");$visualization=document.getElementById("visualization");$githubLink=document.querySelector(".github-link");$visualizationData=document.getElementById("visualization-data");fetch("./data/changelogswithstars.json").then(function(response){return response.json()}).then(function(data){REPOSITORIES=uniqueArray(data);ORDERED_REPOSITORIES=orderRepositoriesByStars();prepareDataForChoiceSelect();createChoiceSelect("stars")})};var prepareDataForChoiceSelect=function prepareDataForChoiceSelect(){choicesItems=ORDERED_REPOSITORIES.map(function(repo){var repoOwner=repo.name.split("/")[0];var repoName=repo.name.split("/")[1];return{value:repo.name,label:repoOwner+" / "+repoName,selected:false,disabled:false,customProperties:{stars:parseInt(repo.stars),name:repoName,owner:repoOwner}}});choicesItems.unshift({value:"",label:"Select or find a repository",placeholder:true,disabled:true,selected:false});if(choiceSelectReference){choiceSelectReference.destroy()}};var createChoiceSelect=function createChoiceSelect(filter){var sortFilterMethod=void 0;if(filter==="stars"){sortFilterMethod=function sortFilterMethod(a,b){if(typeof a.customProperties!=="undefined"&&typeof b.customProperties!=="undefined"){return a.customProperties.stars!==b.customProperties.stars?a.customProperties.stars<b.customProperties.stars?1:-1:0}else{return 0}}}else{sortFilterMethod=function sortFilterMethod(a,b){return a.customProperties.name!==b.customProperties.name?a.customProperties.name>b.customProperties.name?1:-1:0}}choiceSelectReference=new Choices($repositoryDropdown,{itemSelectText:"",choices:choicesItems,placeholderValue:"Please Choose…",sortFilter:sortFilterMethod,shouldSort:false,callbackOnCreateTemplates:function callbackOnCreateTemplates(template){var _this=this;var classNames=this.config.classNames;return{item:function item(data){if(data.customProperties){return template('\n                            <div class="'+classNames.item+" "+(data.highlighted?classNames.highlightedState:classNames.itemSelectable)+'" data-item data-id="'+data.id+'" data-value="'+data.value+'" '+(data.active?'aria-selected="true"':"")+" "+(data.disabled?'aria-disabled="true"':"")+">\n                                "+GITHUB_BOOK_SVG+'<span class="repo-name">'+data.label+'</span>&nbsp;<span class="list-stars list-stars-selected">'+data.customProperties.stars+" &#9733;</span>\n                            </div>\n                        ")}else{return template('\n                        <div class="'+classNames.item+" "+classNames.itemChoice+" "+(data.disabled?classNames.itemDisabled:classNames.itemSelectable)+'" data-select-text="'+_this.config.itemSelectText+'" data-choice '+(data.disabled?'data-choice-disabled aria-disabled="true"':"data-choice-selectable")+' data-id="'+data.id+'" data-value="'+data.value+'" '+(data.groupId>0?'role="treeitem"':'role="option"')+">\n                            <span>"+data.label+"</span>\n                        </div>\n                    ")}},choice:function choice(data){if(data.customProperties){return template('\n                            <div class="'+classNames.item+" "+classNames.itemChoice+" "+(data.disabled?classNames.itemDisabled:classNames.itemSelectable)+'" data-select-text="'+_this.config.itemSelectText+'" data-choice '+(data.disabled?'data-choice-disabled aria-disabled="true"':"data-choice-selectable")+' data-id="'+data.id+'" data-value="'+data.value+'" '+(data.groupId>0?'role="treeitem"':'role="option"')+">\n                                "+GITHUB_BOOK_SVG+'<span class="repo-name">'+data.label+'</span>&nbsp;<span class="list-stars">'+data.customProperties.stars+" &#9733;</span>\n                            </div>\n                        ")}else{return template('\n                            <div class="'+classNames.item+" "+classNames.itemChoice+" "+(data.disabled?classNames.itemDisabled:classNames.itemSelectable)+'" data-select-text="'+_this.config.itemSelectText+'" data-choice '+(data.disabled?'data-choice-disabled aria-disabled="true"':"data-choice-selectable")+' data-id="'+data.id+'" data-value="'+data.value+'" '+(data.groupId>0?'role="treeitem"':'role="option"')+'>\n                                <span class="repo-name">'+data.label+"</span>\n                            </div>\n                        ")}}}}})};var orderRepositoriesAlphabetically=function orderRepositoriesAlphabetically(){return REPOSITORIES.sort(function(a,b){return a.name.split("/")[1]!==b.name.split("/")[1]?a.name.split("/")[1]<b.name.split("/")[1]?-1:1:0})};var orderRepositoriesByStars=function orderRepositoriesByStars(){return REPOSITORIES.sort(function(a,b){return a.stars!==b.stars?a.stars<b.stars?1:-1:0})};var renderMarkdownToHTML=function renderMarkdownToHTML(rawMarkdown){unified().use(markdown).use(markdownhtml).process(rawMarkdown,function(err,file){if(err)throw err;$visualizationData.innerHTML=$ERROR_PARSING_MESSAGE+file;$visualization.classList.add("html")})};var fetchChangelog=function fetchChangelog(repository){function displayFetchError(){if(spinner){hideSpinner()}notifier.show("Oups !",ERROR_FETCH_MESSAGE,"danger","",NOTIFIER_DELAY)}function handleErrors(response){if(!response.ok){displayFetchError();throw Error(response.statusText)}return response}fetch("https://raw.githubusercontent.com/"+repository+"/master/CHANGELOG.md").then(handleErrors).then(function(response){return response.text()}).then(function(data){processChangelog(data)}).catch(function(){displayFetchError()})};document.querySelector("select").addEventListener("change",function(event){selectedRepository=event.currentTarget.value;if(typeof timelineReference!=="undefined"&&timelineReference!==null){timelineReference.destroy();timelineReference=null}$visualizationData.innerHTML="";displayVizualisation();showSpinner();populateGithubLink(selectedRepository);fetchChangelog(selectedRepository)});var populateGithubLink=function populateGithubLink(selectedRepository){$githubLink.style.opacity=1;$githubLink.setAttribute("href","https://github.com/"+selectedRepository)};var hideGithubLink=function hideGithubLink(){$githubLink.style.opacity=0};var displayVizualisation=function displayVizualisation(){$visualization.style.display="block"};var processChangelog=function processChangelog(rawMardown){var _unified=unified().use(markdown);var markdownAST=_unified.parse(rawMardown);headingsWithSemVer=[];var lastVersionIndex=null;markdownAST.children.filter(function(node){var nodeChildren=node.children,hasSemVer=false,hasTime=false,version="",time="";if(node.type==="heading"){var i=0,len=nodeChildren.length;for(i;i<len;i++){if(nodeChildren[i].type==="link"){var link=nodeChildren[i].children[0];if(SEMVER_REGEX().test(link.value)){hasSemVer=true;version=link.value}}}if(!hasSemVer){i=0;for(i;i<len;i++){if(nodeChildren[i].type==="text"){var text=nodeChildren[i].value;if(SEMVER_REGEX().test(text)){hasSemVer=true;version=text.match(SEMVER_REGEX())[0]}}}}if(hasSemVer){i=0;for(i;i<len;i++){if(nodeChildren[i].type==="text"){var _text=nodeChildren[i].value;if(DATE_REGEX().test(_text)){time=_text.match(DATE_REGEX())[0];hasTime=true}}}if(hasTime){headingsWithSemVer.push({time:time,version:version,children:[]});lastVersionIndex=headingsWithSemVer.length-1}}}if(lastVersionIndex!==null){headingsWithSemVer[lastVersionIndex].children.push(node)}});if(headingsWithSemVer.length===0){hideSpinner();renderMarkdownToHTML(rawMardown)}else{createGraph()}};var createGraph=function createGraph(){var groups=new vis.DataSet;groups.add({id:"0",content:""});var items=new vis.DataSet;var minDate=moment();for(var i=0;i<headingsWithSemVer.length;i++){var momentTime=moment(headingsWithSemVer[i].time);if(moment(momentTime).isBefore(minDate)){minDate=momentTime}items.add({id:i,group:0,content:headingsWithSemVer[i].version,start:headingsWithSemVer[i].time,type:"box"})}var options={groupOrder:"content",min:minDate.subtract(2,"M"),max:moment().add(1,"M"),orientation:{axis:"top",item:"top"},zoomMin:1e3*60*60*24*7*4,onInitialDrawComplete:hideSpinner};$visualizationData.innerHTML="";timelineReference=new vis.Timeline($visualizationData,items,options);timelineReference.setGroups(groups);timelineReference.on("select",function(properties){var indexOfClickedVersion=properties.items[0],clickedVersion=headingsWithSemVer[indexOfClickedVersion];if(typeof clickedVersion!=="undefined"){var childrenTreeOfClickedVersion={type:"root",children:clickedVersion.children};var versionDetails=unified().use(markdown).use(markdownhtml).stringify(childrenTreeOfClickedVersion);Swal({html:versionDetails,showCloseButton:true,focusCancel:false,showConfirmButton:false,grow:"fullscreen",customClass:"swal2-markdown",animation:false})}});timelineReference.setWindow(moment().subtract(2,"years"),moment());$visualization.classList.remove("html")};var spinner=document.querySelector(".spinner");var hideSpinner=function hideSpinner(){spinner.style.display="none"};var showSpinner=function showSpinner(){spinner.style.display="block"};var cleanOrderButtonsState=function cleanOrderButtonsState(){[].concat(_toConsumableArray(document.querySelectorAll(".order-buttons"))).map(function(button){button.classList.remove("selected")})};[].concat(_toConsumableArray(document.querySelectorAll(".order-buttons"))).map(function(button){button.addEventListener("click",function(event){cleanOrderButtonsState();event.currentTarget.classList.add("selected");var dataOrder=event.currentTarget.getAttribute("data-order");var orderType="";if(dataOrder==="asc"){ORDERED_REPOSITORIES=orderRepositoriesAlphabetically();orderType="asc"}else{ORDERED_REPOSITORIES=orderRepositoriesByStars();orderType="stars"}prepareDataForChoiceSelect();hideGithubLink();createChoiceSelect(orderType)})});